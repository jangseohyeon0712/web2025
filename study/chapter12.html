<h1>Chapter 12</h1>
Chapter 12 summary
HTTP/HTTPS<br>
JSON
<br>
<h2>HTTP란</h2>

클라이언트와 서버 간에 자료를 주고받으려면 미리 약속된 규칙이 필요하다.<br>
이것을 프로토콜(protocol)이라고 하고, 웹에서는 <b>HTTP</b> (HyperText Transfer Protocol)라는 프로토콜을 사용한다.<br>
클라이언트에서 서버로 자료 요청하는 것은 <b>HTTP 요청</b> (HTTP request),<br>
서버에서 응답해서 클라이언트로 자료를 보내는 것은 <b>HTTP 응답</b> (HTTP response)이라고 한다.

<br><br>

<b>[HTTP 통신 흐름]</b><br>
웹 브라우저 (클라이언트) → <b>HTTP 요청</b> → 서버<br>
서버 → <b>HTTP 응답</b> → 웹 브라우저 (클라이언트)

<h3>요청 헤더와 응답 헤더</h3>

<img src="images/응답헤더.png"><br>

<b>클라이언트에서 사이트 주소를 입력하고 [Enter]를 누를 때</b><br>
사이트 주소뿐만 아니라 사용 중인 시스템 정보와 웹 브라우저 정보, 사용한 언어 등 다양한 정보까지 함께 전송된다. → 서버로 요청할 때 보내는 헤더를 ‘요청 헤더(<span style="color:gray">request header</span>)’라고 한다.
<br><br>
<b>서버에서 입력한 사이트를 찾아서 클라이언트로 보낼 때</b><br>
<li>응답 메시지를 보내는 시간, 메시지를 클라이언트에 어떻게 표시할지 등의 정보는 ‘응답 헤더(<span style="color:gray">response header</span>)’에 담기고</li>
<li>이미지나 텍스트 같은 실제 사이트 내용은 ‘응답 본문(<span style="color:gray">response body</span>)’에 담겨서 전달된다.</li>
<p>요청 헤더 예시</p>

<img src="images/요청헤더.png"><br>

<b>요청 헤더(Request Header)</b><br>
웹 브라우저(클라이언트)에서 서버에 요청을 보낼 때 함께 전송되는 정보들이다. 예를 들어 위 이미지처럼:<br>
<li><b>요청 메서드(Method)</b>: <span style="color:red">GET</span></li>
<li><b>요청 URL</b>: https://www.google.com/</li>
<li><b>요청 헤더 항목들</b>: host, user-agent, accept, cookie 등</li>
<br>
이런 헤더 정보는 서버가 어떤 데이터를, 어떤 형식으로 반환할지 판단하는 데 사용된다.
<p>POST 방식</p>

<img src="images/post방식.png"><br>

<li><b style="color:blue">POST</b>를 사용하면 요청 내용이 주소에 드러나지 않고 요청 본문(<i>request body</i>)에 따로 담아서 보낸다.</li>
<li style="color:gray">예) 로그인 창에 아이디와 비밀번호를 입력한 후 [로그인] 버튼을 클릭하면,</li>
<li style="color:gray">사용자가 입력한 아이디나 비밀번호는 네트워크 외부에서 알아볼 수 없도록 요청 본문에 담아서 서버로 넘겨진다.</li>
<p>응답 상태</p>

<img src="images/응답상태.png"><br>

<li>클라이언트의 요청을 받은 서버가 필요한 작업을 처리하고 그 결과를 클라이언트로 보낼 때</li>
<li>서버로 요청한 것이 성공적으로 처리되었는지, 또는 요청한 파일이 없어서 실패했는지 등을 응답 상태를 ‘상태’ 칼럼에 숫자로 표시한다.</li>
<li>서버에서 자료를 받아 프로그래밍할 때는 응답 상태를 확인한 후 진행한다.</li>
<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>상태</th>
    <th>메시지</th>
    <th>기능</th>
  </tr>
  <tr>
    <td>2XX</td>
    <td></td>
    <td>자료 요청을 수락했거나 자료 전송이 성공적으로 끝났습니다</td>
  </tr>
  <tr>
    <td>200</td>
    <td>OK</td>
    <td>서버에서 클라이언트로 성공적으로 전송했습니다.</td>
  </tr>
  <tr>
    <td>202</td>
    <td>Accepted</td>
    <td>서버에서 클라이언트 요청을 수락했습니다.</td>
  </tr>
  <tr>
    <td>4XX</td>
    <td></td>
    <td>클라이언트에서 주소를 잘못 입력했거나 요청이 잘못되었습니다.</td>
  </tr>
  <tr>
    <td>400</td>
    <td>Bad Request</td>
    <td>요청을 실패했습니다.</td>
  </tr>
  <tr>
    <td>401</td>
    <td>Unauthorized</td>
    <td>권한이 없어 거절되었습니다. 인증 가능합니다.</td>
  </tr>
  <tr>
    <td>403</td>
    <td>Forbidden</td>
    <td>권한이 없어 거절되었습니다. 인증을 시도해도 계속 거절됩니다.</td>
  </tr>
  <tr>
    <td>404</td>
    <td>Not Found</td>
    <td>문서를 찾을 수 없습니다.</td>
  </tr>
  <tr>
    <td>408</td>
    <td>Request Timeout</td>
    <td>요청 시간이 초과되었습니다.</td>
  </tr>
  <tr>
    <td>5XX</td>
    <td></td>
    <td>서버 측의 오류로 처리할 수 없습니다</td>
  </tr>
  <tr>
    <td>500</td>
    <td>Internal Server Error</td>
    <td>서버 내부에 오류가 발생했습니다.</td>
  </tr>
  <tr>
    <td>503</td>
    <td>Service Unavailable</td>
    <td>요청한 서비스를 이용할 수 없습니다.</td>
  </tr>
</table>
<h4>JSON</h4>
<p>데이터 교환 방식</p>

서버와 클라이언트 간에 자료를 주고받기 위해 양쪽 모두 이해할 수 있는 형식을 사용해야 한다.<br>
<li>XML은 컴퓨터에서 처리하는 모든 문서의 표준 형식이기 때문에 웹에서 사용 가능</li>
<li>최근에는 JSON이라는 형식을 더 많이 사용한다</li>
<p>JSON의 특징</p>

<li>텍스트로만 구성되어 있기 때문에 서버와 클라이언트 사이에 주고받을 때 전송 속도가 아주 빠르다.</li>
<li>JSON은 프로그래밍 언어나 플랫폼에 대해 독립적이기 때문에 C++이나 자바, 자바스크립트, 파이썬 등 많은 언어에서 사용할 수 있다.</li>
<li>자바스크립트 사용자라면 누구나 알고 있는 표기법을 사용하기 때문에 읽기도 쉽고 필요에 따라 자바스크립트 객체로 변환하기도 쉽다.</li>
<p>JSON의 형식</p>

<li>중괄호 { } 사이에 ‘이름’과 ‘값’으로 구성된다.</li>
<li>JSON에서는 <b>‘이름’ 부분에 반드시 큰따옴표를 붙이는 것</b>이 큰 차이점</li>

<br><br>

예) ‘도레미’라는 학생의 수업 신청 정보<br><br>

<b>객체</b><br>
<div style="background-color:#f0f0f0; padding:10px; width:250px; font-family:monospace;">
{<br>
&nbsp;&nbsp;name : "도레미",<br>
&nbsp;&nbsp;major : "컴퓨터 공학",<br>
&nbsp;&nbsp;grade : 2<br>
}
</div>

<br>

<b>JSON</b><br>
<div style="background-color:#f0f0f0; padding:10px; width:300px; font-family:monospace;">
{<br>
&nbsp;&nbsp;"name" : "도레미",<br>
&nbsp;&nbsp;"major" : "컴퓨터 공학",<br>
&nbsp;&nbsp;"grade" : 2<br>
}
</div>

<br>

‘{ "name" : "도레미", "major" : "컴퓨터 공학", "grade" : 2 }’
<p>JSON의 ‘이름’</p>

반드시 큰따옴표(")로 묶어야 한다.<br>
‘이름’에 작은따옴표를 사용하거나 큰따옴표가 없는 이름은 사용할 수 없습니다.

<br><br>
<b style="color:blue;">맞게 사용한 예</b><br>
<div style="background-color:#f0f0f0; padding:8px; width:180px; font-family:monospace;">
{ "name" : "도레미" }
</div>

<br>

<b style="color:blue;">잘못 사용한 예</b><br>
<div style="background-color:#f0f0f0; padding:8px; width:180px; font-family:monospace;">
{ 'name': "도레미" }<br>
{ name : "도레미" }
</div>

<br>

<li>JSON 이름에는 공백(space)이나 하이픈(-), 언더바(_)를 함께 사용할 수 있다.<br>
문법적으로 다음 형식도 가능</li>

<div style="background-color:#f0f0f0; padding:8px; width:250px; font-family:monospace;">
{ "full name" : "도레미" }<br>
{ "full-name" : "도레미" }
</div>

<br>

<li>하지만 이름에 공백이나 하이픈이 있을 경우 프로그램을 통해 그 이름에 접근할 때 쉽지 않기 때문에 둘 이상의 단어로 된 이름을 사용한다면 언더스코어(_)를 사용하는 것이 좋다.</li>

<div style="background-color:#f0f0f0; padding:8px; width:250px; font-family:monospace;">
{ "full_name" : "도레미" }
</div>
<p>JSON의 ‘값’</p>

객체에서는 ‘값’ 부분에 함수(메서드)도 사용할 수 있지만<br>
<b>JSON의 ‘값’에는 숫자, 문자열, boolean, null, 배열만 사용할 수 있고, 함수는 사용할 수 없다.</b>

<br><br>

<li><b>숫자형:</b> JSON에서는 정수와 실수 모두 사용할 수 있지만, 8진수나 16진수를 사용한 표기법은 지원하지 않는다.</li>
<li><b>문자열:</b> JSON 문자열은 항상 큰따옴표(" ")로 묶어야 한다.</li>
<li><b>논릿값과 null:</b> true/false 값을 가지는 논리형을 사용할 수도 있고 null 유형도 사용할 수 있다.</li>
<li><b>문자열, 배열:</b> 문자열이나 배열을 값으로 사용할 수 있다. JSON 문자열 안에 또다른 JSON 문자열을 넣을 수도 있다. JSON에서 배열을 사용할 때에도 일반 배열과 마찬가지로 대괄호([ ])를 사용한다.</li>
<p>JSON 문자열</p>

JSON 문자열 안에 또 다른 JSON 문자열을 지정할 수 있다. <br>
<br>
<span style="color:gray">예) 신청한 과목의 이름과 주당 시간을 새로운 JSON 문자열로 사용</span>

<div style="background-color:#f4f4f4; padding:12px; border:1px solid #ccc; width:340px; font-family:monospace;">
{<br>
&nbsp;&nbsp;"name" : "도레미",<br>
&nbsp;&nbsp;"major" : "컴퓨터 공학",<br>
&nbsp;&nbsp;"grade" : 2,<br>
&nbsp;&nbsp;"course" : {<br>
&nbsp;&nbsp;&nbsp;&nbsp;"title" : "웹 기초",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"timePerWeek" : 3<br>
&nbsp;&nbsp;}<br>
}
</div>
<p>객체를 JSON 형식으로 변환하기</p>

클라이언트에서 정보를 처리할 때는 객체를 사용한다. <br>
객체를 JSON 형식으로 저장하거나, JSON 형식을 요구하는 서버로 넘기려면 <br>
→ 객체를 JSON 형식으로 변환해야 한다. 직렬화(<i>stringify</i>)라고 한다. <br><br>

<div style="background-color:#f0f0f0; padding:8px; display:inline-block;">
  JSON.stringify(<i>객체</i>)
</div>

<div style="background-color:#f9f9f9; border:1px solid #ccc; padding:10px; margin-top:10px; font-family:monospace; width:fit-content;">
let student = {name:"도레미", major:"컴퓨터 공학", grade:2}<br><br>
let json = JSON.stringify(student)
</div>
<p>일반적인 서버와 클라이언트의 통신</p>

1) 웹 브라우저 화면에 ‘www.daum.net’을 입력하고 [Enter]를 누르면 인터넷 회선을 통해 서버 컴퓨터로 접속한다.<br>
2) 서버 컴퓨터에서 해당 페이지를 찾아낸 후 내용을 다운로드해서 웹 브라우저 화면에 보여준다.<br>
3) 메뉴 중에서 '게임'을 클릭하면 현재 화면이 완전히 사라지고 게임과 관련된 페이지로 이동한다.<br><br>

메뉴나 링크를 클릭하면 현재 페이지를 완전히 지우고 새로운 화면을 가져와 보여주는 방식

<br><br>

<p>비동기적으로 통신한다면</p>

페이스북이나 트위터 같은 SNS 사이트를 사용할 때에도 화면을 스크롤하면 사이트 전체가 새로 로딩되는 것이 아니라<br>
기존 내용은 그대로 둔 상태에서 다음 내용만 가져와서 보여준다..<br><br>

이렇게 웹 문서 전체를 다시 불러오지 않고 일부분만 가져와 실행할 수 있는 것은<br>
<b>AJAX(Asynchronous Javascript And XML)</b> 기능 때문

<p>XMLHttpRequest 객체</p>

<li>웹 브라우저에서 서버로 데이터를 요청하고 서버에서 자료를 받아올 때는 HTTP 통신이 가능한 XMLHttpRequest 객체를 사용한다.</li>
<li>XMLHttpRequest 객체의 프로퍼티와 메서드를 사용해서 자료를 주고받거나 상태를 체크한다.</li>
<li>웹 페이지 전체가 아니라 필요한 부분만 자료만 가져올 수 있다.</li>

<br><br>

<span style="font-size: 32px; font-weight: bold;">
  <span style="color: #3b78cb;">XML</span><span style="color: #f7902e;">Http</span><span style="color: black;">Request</span>
</span>

<br><br>

<span style="color: #3b78cb;">‘XML’</span>이라는 자료를 
<span style="color: #f7902e;">‘HTTP’</span> 프로토콜을 사용해서 
‘<span style="color: black;">Request</span>(요청)’한다
<p>XMLHttpRequest 객체 만들기</p>

new 예약어를 사용해서 XMLHttpRequest 객체의 인스턴스를 만든다.<br><br>

<div style="background-color: #eee; display: inline-block; padding: 5px 10px;">
  new XMLHttpRequest()
</div>

<span style="float: right; font-size: 14px; color: #6689cc;">
  인스턴스는 <code>xhr</code>이라는 이름을 많이 사용한다.
</span><br>

<div style="background-color: white; border: 1px solid black; display: inline-block; padding: 5px 10px; margin-top: 8px;">
  let xhr = new XMLHttpRequest()
</div>

<br><br>

XMLHttpRequest 객체를 만들면 서버로 자료를 요청하고 자료를 받아올 수 있다.
<br><br>

<img src="images/xmlhttp.png" style="width: 100%; max-width: 800px;">

<p>open() – 어떤 자료를 가져올지 지정</p>

서버로 자료를 요청할 때 어떤 방식을 사용할지, 어떤 자료가 필요한지, 그리고 비동기 처리 여부를 지정한다.

<div style="background-color: #eee; display: inline-block; padding: 5px 10px; margin: 8px 0;">
  open(방식, 자료 위치, 비동기 여부)
</div>

<ul>
  <li><b>방식:</b> HTTP 요청 방식을 지정한다. <b>GET</b>이나 <b>POST</b> 중 하나이고 대문자로 사용해야 한다.</li>
  <li><b>자료 위치:</b> 요청할 서버의 URL을 지정한다.</li>
  <li><b>비동기 여부:</b> 비동기 요청인지, 동기 요청인지의 여부를 판단하는 항목.<br>
    <span style="color: blue;">true</span> – 비동기, <span style="color: blue;">false</span> – 동기<br>
    기본적으로 비동기 처리하므로 따로 지정하지 않으면 비동기로 처리한다.
  </li>
</ul>
<p>send() – 서버로 요청 전송</p>

사용자 요청을 서버로 보내는 메서드

<div style="background-color: #eee; display: inline-block; padding: 5px 10px; margin: 8px 0;">
  send(내용)
</div>

<ul>
  <li><b>send()</b> 괄호 안에 들어가는 매개변수는 옵션이다.</li>
  <li><b>POST</b> 방식을 사용할 경우에는 서버로 넘길 내용을 매개변수로 넘겨주고,</li>
  <li><b>GET</b> 방식을 사용할 경우에는 <code>null</code>로 넘기거나 빈 상태로 남겨 둔다.</li>
</ul>

(예) GET 방식을 이용해 <span style="color: blue;">test.txt</span> 파일에 비동기 방식으로 연결하려면

<div style="background-color: #eee; padding: 10px; width: fit-content; font-family: monospace;">
  xhr.open("GET", "test.txt", true);<br>
  xhr.send();
</div>
<p>JSON 가져오기 연습</p>

<ul>
  <li>JSON 자료는 기본적으로 서버에 저장되어 있다.</li>
  <li>연습을 위해 사용자 컴퓨터를 서버로 만들어 주는 VS Code의 ‘라이브 서버’를 사용한다.</li>
</ul>

12 폴더에는 <code>student.json</code> 파일이 미리 만들어져 있다.

<div style="background-color: #eee; font-family: monospace; padding: 10px; margin-top: 10px; width: fit-content;">
{<br>
&nbsp;&nbsp;"name" : "도레미",<br>
&nbsp;&nbsp;"major" : "컴퓨터 공학",<br>
&nbsp;&nbsp;"grade" : 2<br>
}
</div>
<p>readyState 프로퍼티</p>

readyState 프로퍼티는 XMLHttpRequest 객체의 현재 상태를 나타낸다.<br>
객체에서 서버로 자료를 요청했는지, 자료가 도착했는지, 사용할 준비가 되었는지 등을 알 수 있다.

<table border="1" cellpadding="8" style="border-collapse: collapse; margin-top: 10px;">
  <tr>
    <th>상태</th>
    <th>기능</th>
  </tr>
  <tr>
    <td>0</td>
    <td>아직 아무 요청도 하지 않은 상태입니다.</td>
  </tr>
  <tr>
    <td>1</td>
    <td>서버로 자료를 요청하고 성공한 상태입니다.</td>
  </tr>
  <tr>
    <td>2</td>
    <td>서버 요청에 대한 응답으로 헤더가 도착한 상태입니다.</td>
  </tr>
  <tr>
    <td>3</td>
    <td>서버에서 자료들이 로딩 중인 상태입니다.</td>
  </tr>
  <tr>
    <td>4</td>
    <td>자료 처리가 끝나서 프로그램에서 사용할 수 있는 상태입니다.</td>
  </tr>
</table>

<div style="margin-top: 10px; color: #6495ED;">
0 → 1 → 2 → 3 → 4 →<br>
0 → 1 …처럼 순서대로 반복한다
</div>
<p>readyState와 state를 어디에 쓰나</p>

readyState 값이 바뀔 때마다 <span style="color:blue;">readystatechange</span> 이벤트가 발생한다.<br>
(예) 요청이 성공적으로 끝났을 때(즉, readyState 값이 4일 때) 실행할 명령은

<div style="background-color: #f4f4f4; border: 1px solid #ccc; padding: 10px; width: fit-content; font-family: monospace; margin-top: 10px;">
xhr.onreadystatechange = function() {<br>
&nbsp;&nbsp;if (xhr.readyState == 4) { &nbsp;&nbsp;<span style="color:gray">// 요청이 성공했다면</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;......<br>
&nbsp;&nbsp;}<br>
}
</div>

<br>

<div style="color: cornflowerblue;">
→ readystatechange 이벤트가 발생했을 때 실행할 함수를 연결한 후<br>
→ 함수 안에서 readyState 값이 4일 경우에 명령을 처리합니다
</div>
readyState 값은 요청이 성공했는지를 알려주기 때문에 만약 서버에 없는 파일을 요청하더라도 readyState 값은 4.<br>
요청에 성공하고 서버에서 필요한 파일을 가져왔는지 체크하려면<br>
readyState 프로퍼티 값이 4이면서 <b>status</b> 프로퍼티 값이 200일 경우

<div style="background-color: #f4f4f4; border: 1px solid #ccc; padding: 10px; width: fit-content; font-family: monospace; margin-top: 10px;">
xhr.onreadystatechange = function() {<br>
&nbsp;&nbsp;if (xhr.readyState === 4 && xhr.status === 200) { &nbsp;&nbsp;<span style="color:gray">// 자료가 있고 가져오는 데 성공했다면</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;......<br>
&nbsp;&nbsp;}<br>
}
</div>
<p>response, responseText 프로퍼티</p>

<li>response : 요청에 대한 응답</li>
<li>responseText : 요청에 대한 응답이 문자열 형태로 저장된다. 이 값을 프로그래밍에 사용.</li>
<li>responseType : 응답 데이터의 종류</li>
<li>responseURL : 응답을 보낸 URL</li>
<li>responseXML : HTML이나 XML 같은 형식의 데이터를 받아올 때 사용</li>

<br>콘솔 창에 다음과 같이 입력하면 어떤 값을 가져왔는지 알 수 있다.<br>

<div style="background-color:#f4f4f4; border:1px solid #ccc; padding:8px; width:fit-content; font-family:monospace;">
xhr.responseText
</div>
<p>예외 처리란</p>

프로그램에서 문제가 발생하면 프로그램은 실행을 멈추기 때문에  
소스를 작성할 때부터 발생할 만한 문제를 미리 고려하고 대비하는 것.  
(예외 처리, 에러 핸들링, 오류 처리 등으로 부른다)

<br><br>
예외(exception)  
- 문법적인 실수로 발생하는 오류  
→ 문법 오류 뒤에 오는 소스는 실행되지 않아서 프로그램이 중단되기도 한다.  
- 프로그램의 작성 의도와 다르게 사용했을 때 (예, 프롬프트 창에서 ‘취소’ 버튼 클릭했을 때)  
→ 이런 상황을 미리 예상해서 처리해 준다
<p>console.error()</p>

콘솔 창에 오류를 표시한다  
오류가 발생하면 빨간색으로 표시되기 때문에 일반 메시지와 구별된다

<br><br>

<script>
try {
  console.log("시작");
  add();
  console.log("실행 중...");
} catch(err) {
  console.log(`오류 발생 : ${err}`);
}
console.log("끝");
</script>

<br><br>

error 객체는 error.name과 error.message로 구성된다

<br><br>

<script>
try {
  ...
} catch(err) {
  console.error(`오류 발생 : ${err}`);
  console.error(`오류 발생 : ${err.name}`);
  console.error(`오류 발생 : ${err.message}`);
}
...
</script>
<p>throw()</p>

사용자가 직접 예외를 만들고 오류 메시지를 지정한다.  
<span style="background-color:#fcefe6">기본형</span> throw <i>메시지</i>  
<span style="background-color:#fcefe6">기본형</span> throw new Error(<i>메시지</i>)

<br><br>
(예) JSON 자료에 ‘이름’ 정보가 없는데 ‘이름’ 정보를 가져오려고 했을 때 오류 메시지를 표시하고 싶다면

<pre>
&lt;script&gt;
let json = '{"grade": 3, "age": 25}';

try {
  let user = JSON.parse(json);
  if (!user.name) {
    <span style="color:red">throw "사용자 이름이 없습니다.";</span>
  }
} catch (err) {
  console.error(err);
}
&lt;/script&gt;
</pre>

또는

<pre>
&lt;script&gt;
let json = '{"grade": 3, "age": 25}';

try {
  let user = JSON.parse(json);
  if (!user.name) {
    <span style="color:red">throw new Error("사용자 이름이 없습니다.");</span>
  }
} catch (err) {
  console.error(err);
}
&lt;/script&gt;
</pre>
<style>
  h1, h2, h3, h4, h5, h6, p {
    font-size: 24px; /* 원하는 크기로 설정 (예: 24px) */
    font-weight: bold; /* 굵게 설정 (선택사항) */
    margin-top: 1em;
    margin-bottom: 0.5em;
  }
</style>
